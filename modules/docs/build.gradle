apply plugin: 'java-base'

ext {
    leafProjects = rootProject.subprojects.findAll { p -> p.subprojects.empty }
}

def javadocProjects = leafProjects.findAll { project -> project.name.endsWith( '-api' ) }

task javadocAll( type: Javadoc ) {
    source javadocProjects.collect { project -> project.sourceSets.main.allJava }
    classpath = files( javadocProjects.collect { project -> project.sourceSets.main.compileClasspath } )
    failOnError = false
    title = "Enonic XP API ${version}"
    verbose = false

    options {
        links 'http://docs.oracle.com/javase/8/docs/api'
        links 'http://www.javadoc.io/doc/com.google.guava/guava/26.0-jre'
        quiet()
        encoding( 'UTF-8' )
    }
}

task javadocZip( type: Zip ) {
    from javadocAll
    classifier = 'javadoc'
}

publishing.publications {
    mavenJava( MavenPublication ) {
        artifact javadocZip
    }
}
